[DEFAULT]
include = cat ~/src/mr/lib/*
# This hack is here because git pull stupidly outputs tag info to stderr.
# Shut it up but let real errors through, for use in cron.
quietupdate = mr -s -n update 3>&1 1>/dev/null 2>&3 | egrep -v '(storing tag|tag: )' || true
lib = 
	hostname="$(hostname)"
	whoami="$(whoami)"
	full() {
		test "$whoami" = skangas
	}
	on() {
		for host in $@; do
			if [ "${host%@*}" != "${host#*@}" ]; then
				if [ "$whoami" != "${host%@*}" ]; then
					continue
				fi
				host="${host#*@}"
			fi
			if [ "$hostname" = "$host" ]; then
				return 0
			fi
		done
		return 1
	}
        admin() {
                on skangas@lenin skangas@castro skangas@marx
        }
	wantx() {
		on skangas@lenin skangas@castro
	}
	private() {
		on skangas@lenin skangas@castro
	}

#########################################################################
# all

[bin]
order = 1
checkout = git clone gitosis@git.marxist.se:bin.git

[.etc/bash.git]
order = 1
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/bash.git' 'bash.git' '../../'

[.etc/cpanplus.git]
order = 1
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/cpanplus.git' 'cpanplus.git' '../../'

[.etc/emacs.git]
order = 1
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/emacs.git' 'emacs.git' '../../'

[.etc/kernel-pkg.git]
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/kernel-pkg.git' 'kernel-pkg.git' '../../'
skip = ! admin

[.etc/mr.git]
order = 1
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/mr.git' 'mr.git' '../../'

[.etc/screen.git]
order = 1
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/screen.git' 'screen.git' '../../'

# [research/haskell.git]
# order = 5

# [research/sicp.git]
# order = 5
# checkout = git clone gitosis@git.marxist.se

#########################################################################
# private

#########################################################################
# wantx

[.etc/backgrounds.git]
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/backgrounds.git' 'backgrounds.git' '../../'
skip = ! wantx

[.etc/conkeror.git]
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/conkeror.git' 'conkeror.git' '../../'
skip = ! wantx

[.etc/fonts.git]
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/fonts.git' 'fonts.git' '../../'
skip = ! wantx

[.etc/mplayer.git]
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/mplayer.git' 'mplayer.git' '../../'
skip = ! wantx

[.etc/xmonad.git]
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/xmonad.git' 'xmonad.git' '../../'
skip = ! wantx

[.etc/xorg.git]
order = 1
checkout = git_fake_bare_checkout 'gitosis@git.marxist.se:etc/xorg.git' 'xorg.git' '../../'
skip = ! wantx

#########################################################################
# some sources

[src/mr]
order=50
checkout = git clone git://git.kitenet.net/mr
skip = ([ "$1" = update ] && ! hours_since "$1" 12)
push = error "can't push!"
